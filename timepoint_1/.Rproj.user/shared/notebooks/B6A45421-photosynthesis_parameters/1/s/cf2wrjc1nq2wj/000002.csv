"0","# Get mean parameter values for each species and site"
"0","meanpars <- df %>%"
"0","  drop_na(.variable) %>%  # Drops rows with NA for .variable (samples that failed PI curve fitting)"
"0","  group_by(species, site, .variable) %>%"
"0","  dplyr::summarize(meanval = mean(.value)) %>%"
"0","  pivot_wider(names_from = .variable, values_from = meanval) %>%"
"0","  rename(Am = b_Am_Intercept, AQY = b_AQY_Intercept, Rd = b_Rd_Intercept, theta = b_theta_Intercept) %>%"
"0","  ungroup()"
"0","# Define PI curve function"
"0","PIfun <- function(I, Am, AQY, Rd, theta, sigma) {"
"0","  (1 / (2 * theta)) * (AQY * I + Am - sqrt((AQY * I + Am)^2 - 4 * AQY * theta * Am * I)) - Rd"
"0","}"
"0","# Produce PI curve for each species/site"
"0","curves <- meanpars %>%"
"0","  nest(pars = c(Am, AQY, Rd, theta, sigma)) %>%"
"0","  mutate(I = list(1:1000),"
"0","         PIcurve = map2(pars, I, ~ pmap_dfc(.x, .f = PIfun, I = .y)))   # curve for each par set and Irradiance"
"0","# Plot"
"0","curves %>% "
"0","  unnest(cols = c(I, PIcurve)) %>%"
"0","  ggplot(aes(x = I, y = V1, color = species)) +"
"0","  geom_line() +"
"0","  facet_wrap(~ site) +"
"0","  labs(x = expression(paste('PAR (', mu, ""mol photons m""^-2, 's'^-1,"")"")),"
"0","       y = expression(paste('Photosynthetic rate (', mu, ""mol O2 cm""^-2, 'h'^-1,"")"")),"
"0","       title = ""Timepoint 1: January, 2020"")"
"2","Error in FUN(X[[i]], ...) : object 'V1' not found
"
